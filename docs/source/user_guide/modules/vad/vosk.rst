.. include:: ../../../reuse_content/vad/vosk.rst
.. include:: ../../../reuse_content/vad/audio_waves.rst

Детектирование речевой активности (Vosk)
========================================

Команда для запуска детектирования речевой активности в аудиовизуальном сигнале:

.. code-block:: sh

   python ./openav/api/vosk_sr.py --config <путь_к_вашему_конфигурационному_файлу>.yaml


.. important:: Для запуска команды необходимо обязательно указать путь к конфигурационному файлу. Запускать программу необходимо из директории, где она расположена.

Конфигурационный файл
~~~~~~~~~~~~~~~~~~~~~

Конфигурационный файл включает в себя следующие настройки:

*  Отображение процесса выполнения программы в терминале (командной строке)
*  Работа с файловой системой
*  Параметры детектора голосовой активности (Vosk)
*  Параметры кодирования выходного файла

.. rst-class:: config-link

|a_config|
Пример конфигурационного файла
|/a|

Отображение процесса выполнения команды в терминале
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. rst-class:: custom-table shell-table
.. csv-table::
   :align: center
   :header: "Параметр", "Тип", "Значение по умолчанию", "Описание"
   :widths: 23, 7, 25, 45

    "hide_metadata", "bool", "``false``", "Включение отображения метаданных"
    "hide_libs_vers", "bool", "``false``", "Включение отображения версий установленных  библиотек  в командной строке"


Работа с файловой системой
~~~~~~~~~~~~~~~~~~~~~~~~~~

.. rst-class:: custom-table filesystem-table
.. csv-table::
   :align: center
   :header: "Параметр", "Тип", "Значение по умолчанию", "Описание"
   :widths: 23, 7, 25, 45

    "path_to_save_model", "str", "``<./models>``", "Директория, где будут размещаться скачанные модели, в данном случае модель для работоспособности  VAD"
    "path_to_dataset", "str", "``<путь_к_исходным_данным>``", "Директория, где находятся данные, которые необходимо обработать"
    "path_to_dataset_vosk_sr", "str", "``<./dataset_vosk>``", "Директория, куда сохраняются фрагменты аудиовизуального сигнала после обработки"
    "dir_va_names", "dict", "``{""video"": ""Video"",`` |br| ``""audio"": ""Audio""}``", "Директории для сохранения видео и аудио файлов. Названия директорий могут быть произвольными"
    "force_reload", "bool", "``false``", "Включение принудительной загрузки модели Vosk из сети"
    "clear_dirvosk_sr", "bool", "``true``", "Очистка директории, в которую сохраняются фрагменты аудиовизуального сигнала"
    "depth","int", "``1``", "Глубина иерархии для получения данных. Указывается количество подкаталогов  в директории ``path_to_dataset``"
    "ext_search_files", "list", "``[""mov"", ""mp4"",`` |br| ``""webm"", ""wav""]``", "Список  расширений файлов, которые будут обрабатываться. Указывать  можно как для видео, так и для аудио"


Параметры детектора голосовой активности (VAD)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. rst-class:: custom-table vad-table
.. csv-table::
   :align: center
   :header: "Параметр", "Тип", "Значение по умолчанию", "Описание"
   :widths: 28, 7, 20, 45

   "sampling_rate", "int", "``16000``", "Частота дискретизации. На текущий момент поддерживаются частоты: ``8000`` и ``16000``"
   "language", "str", "``ru``", "Выбор языка, на котором необходимо обработать данные. Поддерживаемые языки:  ``ru`` и ``en`` "


Параметры кодирования выходного файла
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. rst-class:: custom-table encode-table
.. csv-table::
   :align: center
   :header: "Параметр", "Тип", "Значение по умолчанию", "Описание"
   :widths: 28, 7, 20, 45

    "type_encode", "str", "``crf``", "Типы кодирования. Доступные варианты: ``['qscale', 'crf']``"
    "crf_value", "int", "``23``", "Качество кодирования (от ``0`` до ``51``. Чем ниже значение, тем лучше качество и наоборот. Стоит учитывать, что изменения качества кодирования влияет на скорость обработки"
    "presets_crf_encode", "str", "``medium``", "Скорость кодирования и сжатия. Доступные варианты: ``['ultrafast', 'superfast', 'veryfast', 'faster', 'fast', 'medium', 'slow', 'slower', 'veryslow']``. Изменения параметра влияет на скорость кодирования и степень сжатия"
    "sr_input_type", "str", "``audio``", "Типы файлов для распознавания речи. Доступные варианты: ``['audio', 'video']``"


Демонстрация работы детектора речевой активности
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

В этом разделе представлен результат работы детектора речевой активности на тестовой аудиозаписи с настройками, которые указаны в конфигурационном файле.

|b| Пример аудиозаписи до обработки детектором речевой активности: |/b|

|audio_wo_vad|

|b| Пример аудиозаписи после обработки детектором речевой активности: |/b|

|audio_1|
|audio_2|
|audio_3|
|audio_4|
|audio_5|
